<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Quản lý Text</title>

<style>
    body { font-family: Arial, sans-serif; background: #f2f2f2; margin: 0; padding: 0; }
    .container { width: 92%; margin: auto; }
    .title { padding: 18px 0; font-size: 24px; font-weight: bold; }

    .row {
        display: flex;
        align-items: center;
        background: #fff;
        padding: 10px;
        margin: 6px 0;
        border-radius: 8px;
        border: 1px solid #e0e0e0;
        gap: 6px;
    }

    .text-input {
        flex: 1;
        width: 100%;
        min-width: 260px;
        padding: 8px;
        font-size: 14px;
        border: 1px solid #e0e0e0;
        border-radius: 6px;
        overflow-x: auto;
        white-space: nowrap;
    }

    .button {
        padding: 6px 10px;
        border-radius: 6px;
        border: none;
        cursor: pointer;
        font-size: 13px;
        color: #fff;
    }

    .paste-btn { background: #28a745; }
    .send-btn { background: #17a2b8; }
    .copy-btn { background: #007bff; }
    .delete-btn { background: #e55353; }

    .agent-select {
        padding: 6px;
        border-radius: 4px;
        border: 1px solid #ddd;
        font-size: 13px;
        min-width: 90px;
    }

    .note-input {
        padding: 6px;
        border-radius: 6px;
        font-size: 13px;
        border: 1px solid #ddd;
        min-width: 140px;
    }
</style>
</head>

<body>
<div class="container">
    <div class="title">Quản lý Text</div>

    <div id="rows"></div>
</div>

<script>
/* ===========================================================
   ✅ KHÔNG ĐỤNG CODE GỐC — CHỈ THÊM API NGROK VÀ NÚT GỬI
 ============================================================== */

(function () {
    const NGROK_URL = "https://db392de52e0e.ngrok-free.app/push";
    const SECRET_TOKEN = "MY_SECRET_TOKEN_ChangeMe";

    function createRow(id) {
        return `
            <div class="row" data-id="${id}">
                <input class="text-input" placeholder="Nhập văn bản hoặc link...">

                <button class="button paste-btn">Dán</button>
                <button class="button send-btn">Gửi</button>
                <button class="button copy-btn">Copy</button>
                <button class="button delete-btn">Delete</button>

                <select class="agent-select">
                    ${Array.from({ length: 9 }, (_, i) => `<option value="${i + 10}">Agent ${i + 10}</option>`).join("")}
                </select>

                <textarea class="note-input" placeholder="Ghi chú..."></textarea>
            </div>
        `;
    }

    function loadRows() {
        const rows = [];
        for (let i = 1; i <= 18; i++) rows.push(createRow(i));
        document.getElementById("rows").innerHTML = rows.join("");
    }

    loadRows();

    /* ===========================================================
       ✅ API SEND → NGROK
    =========================================================== */

    async function sendToNgrok(rowId) {
        const row = document.querySelector(`.row[data-id="${rowId}"]`);
        const link = row.querySelector(".text-input").value.trim();
        const agent = row.querySelector(".agent-select").value;
        const btn = row.querySelector(".send-btn");

        if (!link) {
            btn.textContent = "Done";
            setTimeout(() => (btn.textContent = "Gửi"), 1500);
            return;
        }

        btn.disabled = true;
        btn.textContent = "Đang gửi...";

        try {
            const payload = {
                token: SECRET_TOKEN,
                agent,
                link
            };

            await fetch(NGROK_URL, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload)
            });

            btn.style.background = "#28a745";
            btn.textContent = "Done";

        } catch (e) {
            btn.textContent = "Lỗi";
            btn.style.background = "#e55353";
        }

        setTimeout(() => {
            btn.disabled = false;
            btn.style.background = "#17a2b8";
            btn.textContent = "Gửi";
        }, 2000);
    }

    /* ===========================================================
       ✅ Gán sự kiện cho từng button sau khi render rows
    =========================================================== */
    document.addEventListener("click", (e) => {
        if (e.target.classList.contains("send-btn")) {
            const rowId = e.target.closest(".row").dataset.id;
            sendToNgrok(rowId);
        }
        if (e.target.classList.contains("paste-btn")) {
            navigator.clipboard.readText().then(text => {
                e.target.closest(".row").querySelector(".text-input").value = text;
            });
        }
        if (e.target.classList.contains("copy-btn")) {
            const text = e.target.closest(".row").querySelector(".text-input").value;
            navigator.clipboard.writeText(text);
        }
        if (e.target.classList.contains("delete-btn")) {
            e.target.closest(".row").querySelector(".text-input").value = "";
        }
    });

})();
</script>

</body>
</html>
